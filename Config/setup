#!/usr/local/bin/bash

cmd=$(basename "$0")
dir=$(dirname  "$0")
cd "$dir"
dir=$PWD
bindir=$(dirname "$dir")

echo cmd is $cmd
echo dir is $dir
echo bin is $bindir

cd $bindir
rm -f ~/Bin; ln -s "$PWD" ~/Bin

cd $dir

p=$(perl -e 'use Cwd; $cwd = cwd(); $cwd =~ s|^/tmp_mnt||; print $cwd;')

for l in bash_login bash_profile profile; do
    rm -f $l
    ln -s bashrc $l
done

rm -f *~ emacs xinitrc ~/.ssh/config
ln -s ../elisp/emacs.el emacs
ln -s xsession xinitrc

if [ ! -d ~/.ssh ]; then
    mkdir ~/.ssh
fi

ln misc/ssh_config ~/.ssh/config
chmod 700 ~/.ssh ~/.ssh/config

for f in $( ls ) ; do
  if [ -f $f ]; then
    if [ $f != $cmd ]; then
      if [ -L ~/.$f ]; then
	echo Removing symlink ~/.$f
	rm ~/.$f
      fi
      
      if [ -f ~/.$f ]; then
	echo Moving ~/.$f to ~/.$f.old
	mv ~/.$f ~/.$f.old
      fi
      
      echo Linking $p/$f from ~/.$f
      ln -s $p/$f ~/.$f
    fi
  fi
done
