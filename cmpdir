#!/usr/local/10bin/perl5 -w

$dirnameA = $ARGV[0];
$dirnameB = $ARGV[1];

&cmp( $dirnameA, $dirnameB );

exit;

sub cmp {
	local( $aDir, $bDir ) = @_;

	print "CMP: $aDir <-> $bDir\n";

	if ( -d $aDir && -d $bDir ) {
		&cmpdirs( $aDir, $bDir ); 
	} else {
		&cmpfiles( $aDir, $bDir );
	}
}

sub cmpdirs {
	local( $aDir, $bDir ) = @_;
	local( @listA, @listB );

	if ( -d $aDir && -d $bDir ) {
		@listA = &dirlist( $aDir );

		while ( $file = shift( @listA ) ) {
			&cmp( "$aDir/$file", "$bDir/$file" );
		}

	} else {
		warn( "$aDir or $bDir is not a directory.\n" );
	}

}

sub cmpfiles {
	local( $aFile, $bFile ) = @_;

	if ( -f $aFile && -f $bFile ) {
		system( "cmp $aFile $bFile" );
	} else {
		warn( "$aFile or $bFile is not a normal file.\n" );
	}
}

sub dirlist {
	local( $directory ) = @_;
	local( @list );

	opendir( DIR, "$directory" )
		|| die( "Cannot open directory: $directory\n" );

	while( $item = readdir( DIR ) ) {
		unless ( $item =~ "^\.{1,2}$" ) {
			push( @list, $item );
		}
	}

	closedir( DIR );

	return @list;
}
