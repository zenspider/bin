#!/usr/local/bin/ruby -ws

$n ||= false
$b ||= false
$o ||= false
$h ||= false
$s ||= false

if $h then
  puts "#{File.basename($0)} [options] [files]"
  puts "  -b - strip leading and trailing whitespace, and blanks"
  puts "  -n - convert numbers to '<num>'"
  puts "  -o - skip lines that only occur once"
  puts "  -s - sort by line, rather than occurance"
  puts "  -h - show help"
  exit 0
end

c = {}
c.default = 0

ARGF.each do |$_|
  chomp

  gsub!(/\d+/, "<num>") if $n
  if $b then
    $_.strip!
    next if $_.empty?
  end
  
  c[$_] += 1
end

if $s then
  sorted = c.keys.sort
else
  sorted = c.keys.sort { |a,b| c[b] <=> c[a] }
end

sorted.each do |key|
  next if $o and c[key] == 1
  printf "%5d: %s\n", c[key], key
end
